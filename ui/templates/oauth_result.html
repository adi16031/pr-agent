<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>GitHub OAuth - PR Agent</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background: #f6f8fa;
      }
      .container {
        background: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        text-align: center;
        max-width: 500px;
      }
      .success-icon {
        font-size: 64px;
        color: #28a745;
      }
      .error-icon {
        font-size: 64px;
        color: #dc3545;
      }
      h1 {
        margin: 20px 0 10px 0;
        font-size: 24px;
      }
      p {
        color: #666;
        line-height: 1.6;
      }
      .close-btn {
        margin-top: 20px;
        background: #0366d6;
        color: white;
        border: none;
        padding: 10px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
      }
      .close-btn:hover {
        background: #0256b8;
      }
      .error-details {
        background: #f8d7da;
        color: #721c24;
        padding: 12px;
        border-radius: 6px;
        margin-top: 16px;
        font-size: 13px;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <div class="container">
      {% if success %}
        <div class="success-icon">✓</div>
        <h1>Authorization Successful!</h1>
        <p>Your GitHub account has been successfully connected.</p>
        <p>The access token has been saved and you can now use it to access your repositories.</p>
        <button class="close-btn" onclick="closeWindow()">Close Window</button>
      {% else %}
        <div class="error-icon">✗</div>
        <h1>Authorization Failed</h1>
        <p>There was a problem connecting your GitHub account.</p>
        {% if error %}
        <div class="error-details">
          <strong>Error:</strong> {{ error }}
        </div>
        {% endif %}
        <button class="close-btn" onclick="closeWindow()">Close Window</button>
      {% endif %}
    </div>
    
    <script>
      // @ts-nocheck
      // Jinja2 template - variables are rendered server-side
      var oauthSuccess = {{ 'true' if success else 'false' }};
      var oauthError = {{ error|tojson if error else 'null' }};
      
      function closeWindow() {
        // Try to close the window
        window.close();
        
        // If window doesn't close (because it wasn't opened by script), redirect back
        setTimeout(function() {
          window.location.href = '/';
        }, 100);
      }
      
      // Auto-close after success
      if (oauthSuccess) {
        setTimeout(function() {
          closeWindow();
        }, 3000);
      }
      
      // Notify parent window if opened as popup
      if (window.opener) {
        var message = {
          type: 'github_oauth_result',
          success: oauthSuccess
        };
        
        if (oauthError) {
          message.error = oauthError;
        }
        
        window.opener.postMessage(message, '*');
      }
    </script>
  </body>
</html>
